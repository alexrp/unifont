<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GNU Unifont: src/unibmpbump.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GNU Unifont<span id="projectnumber">&#160;15.1.05</span>
   </div>
   <div id="projectbrief">Pan-Unicode font with complete Unicode Plane 0  coverage and partial coverage of higher planes</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('unibmpbump_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">unibmpbump.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>unibmpbump - Adjust a Microsoft bitmap (.bmp) file that was created by unihex2png but converted to .bmp  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for unibmpbump.c:</div>
<div class="dyncontent">
<div class="center"><img src="unibmpbump_8c__incl.png" border="0" usemap="#asrc_2unibmpbump_8c" alt=""/></div>
<map name="asrc_2unibmpbump_8c" id="asrc_2unibmpbump_8c">
<area shape="rect" title="unibmpbump &#45; Adjust a Microsoft bitmap (.bmp) file that was created by unihex2png but converted to ...." alt="" coords="61,5,203,31"/>
<area shape="rect" title=" " alt="" coords="5,79,72,104"/>
<area shape="rect" title=" " alt="" coords="97,79,167,104"/>
<area shape="rect" title=" " alt="" coords="191,79,262,104"/>
</map>
</div>
</div>
<p><a href="unibmpbump_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1c6d5de492ac61ad29aec7aa9a436bbf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="unibmpbump_8c.html#a1c6d5de492ac61ad29aec7aa9a436bbf">VERSION</a>&#160;&#160;&#160;&quot;1.0&quot;</td></tr>
<tr class="memdesc:a1c6d5de492ac61ad29aec7aa9a436bbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Version of this program.  <br /></td></tr>
<tr class="separator:a1c6d5de492ac61ad29aec7aa9a436bbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadfd205e5b62832a2ef6266260cb55f1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="unibmpbump_8c.html#aadfd205e5b62832a2ef6266260cb55f1">MAX_COMPRESSION_METHOD</a>&#160;&#160;&#160;13</td></tr>
<tr class="memdesc:aadfd205e5b62832a2ef6266260cb55f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum supported compression method.  <br /></td></tr>
<tr class="separator:aadfd205e5b62832a2ef6266260cb55f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="unibmpbump_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="memdesc:a0ddf1224851353fc92bfbff6f499fa97"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main function.  <br /></td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace9584f7b69b95621366833332b30465"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (FILE *infp, int nbytes)</td></tr>
<tr class="memdesc:ace9584f7b69b95621366833332b30465"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get from 1 to 4 bytes, inclusive, from input file.  <br /></td></tr>
<tr class="separator:ace9584f7b69b95621366833332b30465"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58f734bf43b58f0f2c28fd4a0582c0f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="unibmpbump_8c.html#a58f734bf43b58f0f2c28fd4a0582c0f4">regrid</a> (unsigned *image_bytes)</td></tr>
<tr class="memdesc:a58f734bf43b58f0f2c28fd4a0582c0f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">After reading in the image, shift it.  <br /></td></tr>
<tr class="separator:a58f734bf43b58f0f2c28fd4a0582c0f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>unibmpbump - Adjust a Microsoft bitmap (.bmp) file that was created by unihex2png but converted to .bmp </p>
<dl class="section author"><dt>Author</dt><dd>Paul Hardy, unifoundry &lt;at&gt; unifoundry.com</dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright (C) 2019 Paul Hardy</dd></dl>
<p>This program shifts the glyphs in a bitmap file to adjust an original PNG file that was saved in BMP format. This is so the result matches the format of a unihex2bmp image. This conversion then lets unibmp2hex decode the result.</p>
<p>Synopsis: unibmpbump [-iin_file.bmp] [-oout_file.bmp] </p>

<p class="definition">Definition in file <a class="el" href="unibmpbump_8c_source.html">unibmpbump.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aadfd205e5b62832a2ef6266260cb55f1" name="aadfd205e5b62832a2ef6266260cb55f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadfd205e5b62832a2ef6266260cb55f1">&#9670;&#160;</a></span>MAX_COMPRESSION_METHOD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_COMPRESSION_METHOD&#160;&#160;&#160;13</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum supported compression method. </p>

<p class="definition">Definition at line <a class="el" href="unibmpbump_8c_source.html#l00040">40</a> of file <a class="el" href="unibmpbump_8c_source.html">unibmpbump.c</a>.</p>

</div>
</div>
<a id="a1c6d5de492ac61ad29aec7aa9a436bbf" name="a1c6d5de492ac61ad29aec7aa9a436bbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c6d5de492ac61ad29aec7aa9a436bbf">&#9670;&#160;</a></span>VERSION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERSION&#160;&#160;&#160;&quot;1.0&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Version of this program. </p>

<p class="definition">Definition at line <a class="el" href="unibmpbump_8c_source.html#l00038">38</a> of file <a class="el" href="unibmpbump_8c_source.html">unibmpbump.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ace9584f7b69b95621366833332b30465" name="ace9584f7b69b95621366833332b30465"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace9584f7b69b95621366833332b30465">&#9670;&#160;</a></span>get_bytes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned get_bytes </td>
          <td>(</td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>infp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nbytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get from 1 to 4 bytes, inclusive, from input file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">infp</td><td>Pointer to input file. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nbytes</td><td>Number of bytes to read, from 1 to 4, inclusive. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The unsigned 1 to 4 bytes in machine native endian format. </dd></dl>

<p class="definition">Definition at line <a class="el" href="unibmpbump_8c_source.html#l00487">487</a> of file <a class="el" href="unibmpbump_8c_source.html">unibmpbump.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  487</span>                                            {</div>
<div class="line"><span class="lineno">  488</span>   <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  489</span>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> inchar[4];</div>
<div class="line"><span class="lineno">  490</span>   <span class="keywordtype">unsigned</span> inword;</div>
<div class="line"><span class="lineno">  491</span> </div>
<div class="line"><span class="lineno">  492</span>   <span class="keywordflow">for</span> (i = 0; i &lt; nbytes; i++) {</div>
<div class="line"><span class="lineno">  493</span>      <span class="keywordflow">if</span> (fread (&amp;inchar[i], 1, 1, infp) != 1) {</div>
<div class="line"><span class="lineno">  494</span>         inchar[i] = 0;</div>
<div class="line"><span class="lineno">  495</span>      }</div>
<div class="line"><span class="lineno">  496</span>   }</div>
<div class="line"><span class="lineno">  497</span>   <span class="keywordflow">for</span> (i = nbytes; i &lt; 4; i++) inchar[i] = 0;</div>
<div class="line"><span class="lineno">  498</span> </div>
<div class="line"><span class="lineno">  499</span>   inword = ((inchar[3] &amp; 0xFF) &lt;&lt; 24) | ((inchar[2] &amp; 0xFF) &lt;&lt; 16) |</div>
<div class="line"><span class="lineno">  500</span>            ((inchar[1] &amp; 0xFF) &lt;&lt;  8) |  (inchar[0] &amp; 0xFF);</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span>   <span class="keywordflow">return</span> inword;</div>
<div class="line"><span class="lineno">  503</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="unibmpbump_8c_ace9584f7b69b95621366833332b30465_icgraph.png" border="0" usemap="#aunibmpbump_8c_ace9584f7b69b95621366833332b30465_icgraph" alt=""/></div>
<map name="aunibmpbump_8c_ace9584f7b69b95621366833332b30465_icgraph" id="aunibmpbump_8c_ace9584f7b69b95621366833332b30465_icgraph">
<area shape="rect" title="Get from 1 to 4 bytes, inclusive, from input file." alt="" coords="108,5,195,31"/>
<area shape="rect" href="unibmpbump_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="The main function." alt="" coords="5,5,60,31"/>
</map>
</div>

</div>
</div>
<a id="a0ddf1224851353fc92bfbff6f499fa97" name="a0ddf1224851353fc92bfbff6f499fa97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ddf1224851353fc92bfbff6f499fa97">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The main function. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">argc</td><td>The count of command line arguments. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">argv</td><td>Pointer to array of command line arguments. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This program exits with status EXIT_SUCCESS. </dd></dl>

<p class="definition">Definition at line <a class="el" href="unibmpbump_8c_source.html#l00050">50</a> of file <a class="el" href="unibmpbump_8c_source.html">unibmpbump.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   50</span>                                  {</div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   53</span><span class="comment">      Values preserved from file header (first 14 bytes).</span></div>
<div class="line"><span class="lineno">   54</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">   55</span>   <span class="keywordtype">char</span> file_format[3];       <span class="comment">/* &quot;BM&quot; for original Windows format           */</span></div>
<div class="line"><span class="lineno">   56</span>   <span class="keywordtype">unsigned</span> filesize;         <span class="comment">/* size of file in bytes                      */</span></div>
<div class="line"><span class="lineno">   57</span>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> rsvd_hdr[4]; <span class="comment">/* 4 reserved bytes                           */</span></div>
<div class="line"><span class="lineno">   58</span>   <span class="keywordtype">unsigned</span> image_start;      <span class="comment">/* byte offset of image in file               */</span></div>
<div class="line"><span class="lineno">   59</span> </div>
<div class="line"><span class="lineno">   60</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   61</span><span class="comment">      Values preserved from Device Independent Bitmap (DIB) Header.</span></div>
<div class="line"><span class="lineno">   62</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">   63</span><span class="comment">      The DIB fields below are in the standard 40-byte header.  Version</span></div>
<div class="line"><span class="lineno">   64</span><span class="comment">      4 and version 5 headers have more information, mainly for color</span></div>
<div class="line"><span class="lineno">   65</span><span class="comment">      information.  That is skipped over, because a valid glyph image</span></div>
<div class="line"><span class="lineno">   66</span><span class="comment">      is just monochrome.</span></div>
<div class="line"><span class="lineno">   67</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">   68</span>   <span class="keywordtype">int</span> dib_length;            <span class="comment">/* in bytes, for parsing by header version    */</span></div>
<div class="line"><span class="lineno">   69</span>   <span class="keywordtype">int</span> image_width = 0;       <span class="comment">/* Signed image width                         */</span></div>
<div class="line"><span class="lineno">   70</span>   <span class="keywordtype">int</span> image_height = 0;      <span class="comment">/* Signed image height                        */</span></div>
<div class="line"><span class="lineno">   71</span>   <span class="keywordtype">int</span> num_planes = 0;        <span class="comment">/* number of planes; must be 1                */</span></div>
<div class="line"><span class="lineno">   72</span>   <span class="keywordtype">int</span> bits_per_pixel = 0;    <span class="comment">/* for palletized color maps (&lt; 2^16 colors)  */</span></div>
<div class="line"><span class="lineno">   73</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   74</span><span class="comment">      The following fields are not in the original spec, so initialize</span></div>
<div class="line"><span class="lineno">   75</span><span class="comment">      them to 0 so we can correctly parse an original file format.</span></div>
<div class="line"><span class="lineno">   76</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">   77</span>   <span class="keywordtype">int</span> compression_method=0;  <span class="comment">/* 0 --&gt; uncompressed RGB/monochrome          */</span></div>
<div class="line"><span class="lineno">   78</span>   <span class="keywordtype">int</span> image_size = 0;        <span class="comment">/* 0 is a valid size if no compression        */</span></div>
<div class="line"><span class="lineno">   79</span>   <span class="keywordtype">int</span> hres = 0;              <span class="comment">/* image horizontal resolution                */</span></div>
<div class="line"><span class="lineno">   80</span>   <span class="keywordtype">int</span> vres = 0;              <span class="comment">/* image vertical resolution                  */</span></div>
<div class="line"><span class="lineno">   81</span>   <span class="keywordtype">int</span> num_colors = 0;        <span class="comment">/* Number of colors for pallettized images    */</span></div>
<div class="line"><span class="lineno">   82</span>   <span class="keywordtype">int</span> important_colors = 0;  <span class="comment">/* Number of significant colors (0 or 2)      */</span></div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>   <span class="keywordtype">int</span> true_colors = 0;       <span class="comment">/* interpret num_colors, which can equal 0    */</span></div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   87</span><span class="comment">      Color map.  This should be a monochrome file, so only two</span></div>
<div class="line"><span class="lineno">   88</span><span class="comment">      colors are stored.</span></div>
<div class="line"><span class="lineno">   89</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">   90</span>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> color_map[2][4]; <span class="comment">/* two of R, G, B, and possibly alpha  */</span></div>
<div class="line"><span class="lineno">   91</span> </div>
<div class="line"><span class="lineno">   92</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   93</span><span class="comment">      The monochrome image bitmap, stored as a vector 544 rows by</span></div>
<div class="line"><span class="lineno">   94</span><span class="comment">      72*8 columns.</span></div>
<div class="line"><span class="lineno">   95</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">   96</span>   <span class="keywordtype">unsigned</span> image_bytes[544*72];</div>
<div class="line"><span class="lineno">   97</span> </div>
<div class="line"><span class="lineno">   98</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   99</span><span class="comment">      Flags for conversion &amp; I/O.</span></div>
<div class="line"><span class="lineno">  100</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  101</span>   <span class="keywordtype">int</span> verbose      = 0;      <span class="comment">/* Whether to print file info on stderr     */</span></div>
<div class="line"><span class="lineno">  102</span>   <span class="keywordtype">unsigned</span> image_xor = 0x00; <span class="comment">/* Invert (= 0xFF) if color 0 is not black  */</span></div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  105</span><span class="comment">      Temporary variables.</span></div>
<div class="line"><span class="lineno">  106</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  107</span>   <span class="keywordtype">int</span> i, j, k;           <span class="comment">/* loop variables */</span></div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>   <span class="comment">/* Compression type, for parsing file */</span></div>
<div class="line"><span class="lineno">  110</span>   <span class="keywordtype">char</span> *compression_type[<a class="code hl_define" href="unibmpbump_8c.html#aadfd205e5b62832a2ef6266260cb55f1">MAX_COMPRESSION_METHOD</a> + 1] = {</div>
<div class="line"><span class="lineno">  111</span>      <span class="stringliteral">&quot;BI_RGB&quot;</span>,            <span class="comment">/*  0 */</span></div>
<div class="line"><span class="lineno">  112</span>      <span class="stringliteral">&quot;BI_RLE8&quot;</span>,           <span class="comment">/*  1 */</span></div>
<div class="line"><span class="lineno">  113</span>      <span class="stringliteral">&quot;BI_RLE4&quot;</span>,           <span class="comment">/*  2 */</span></div>
<div class="line"><span class="lineno">  114</span>      <span class="stringliteral">&quot;BI_BITFIELDS&quot;</span>,      <span class="comment">/*  3 */</span></div>
<div class="line"><span class="lineno">  115</span>      <span class="stringliteral">&quot;BI_JPEG&quot;</span>,           <span class="comment">/*  4 */</span></div>
<div class="line"><span class="lineno">  116</span>      <span class="stringliteral">&quot;BI_PNG&quot;</span>,            <span class="comment">/*  5 */</span></div>
<div class="line"><span class="lineno">  117</span>      <span class="stringliteral">&quot;BI_ALPHABITFIELDS&quot;</span>, <span class="comment">/*  6 */</span></div>
<div class="line"><span class="lineno">  118</span>      <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>,      <span class="comment">/*  7 - 10 */</span></div>
<div class="line"><span class="lineno">  119</span>      <span class="stringliteral">&quot;BI_CMYK&quot;</span>,           <span class="comment">/* 11 */</span></div>
<div class="line"><span class="lineno">  120</span>      <span class="stringliteral">&quot;BI_CMYKRLE8&quot;</span>,       <span class="comment">/* 12 */</span></div>
<div class="line"><span class="lineno">  121</span>      <span class="stringliteral">&quot;BI_CMYKRLE4&quot;</span>,       <span class="comment">/* 13 */</span></div>
<div class="line"><span class="lineno">  122</span>   };</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>   <span class="comment">/* Standard unihex2bmp.c header for BMP image */</span></div>
<div class="line"><span class="lineno">  125</span>   <span class="keywordtype">unsigned</span> standard_header [62] = {</div>
<div class="line"><span class="lineno">  126</span>      <span class="comment">/*  0 */</span> 0x42, 0x4d, 0x3e, 0x99, 0x00, 0x00, 0x00, 0x00,</div>
<div class="line"><span class="lineno">  127</span>      <span class="comment">/*  8 */</span> 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x28, 0x00,</div>
<div class="line"><span class="lineno">  128</span>      <span class="comment">/* 16 */</span> 0x00, 0x00, 0x40, 0x02, 0x00, 0x00, 0x20, 0x02,</div>
<div class="line"><span class="lineno">  129</span>      <span class="comment">/* 24 */</span> 0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00,</div>
<div class="line"><span class="lineno">  130</span>      <span class="comment">/* 32 */</span> 0x00, 0x00, 0x00, 0x99, 0x00, 0x00, 0xc4, 0x0e,</div>
<div class="line"><span class="lineno">  131</span>      <span class="comment">/* 40 */</span> 0x00, 0x00, 0xc4, 0x0e, 0x00, 0x00, 0x00, 0x00,</div>
<div class="line"><span class="lineno">  132</span>      <span class="comment">/* 48 */</span> 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,</div>
<div class="line"><span class="lineno">  133</span>      <span class="comment">/* 56 */</span> 0x00, 0x00, 0xff, 0xff, 0xff, 0x00</div>
<div class="line"><span class="lineno">  134</span>   };</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>   <span class="keywordtype">unsigned</span> <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (FILE *, <span class="keywordtype">int</span>);</div>
<div class="line"><span class="lineno">  137</span>   <span class="keywordtype">void</span>     <a class="code hl_function" href="unibmpbump_8c.html#a58f734bf43b58f0f2c28fd4a0582c0f4">regrid</a>    (<span class="keywordtype">unsigned</span> *);</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>   <span class="keywordtype">char</span> *infile=<span class="stringliteral">&quot;&quot;</span>, *outfile=<span class="stringliteral">&quot;&quot;</span>;  <span class="comment">/* names of input and output files         */</span></div>
<div class="line"><span class="lineno">  140</span>   FILE *infp, *outfp;            <span class="comment">/* file pointers of input and output files */</span></div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  143</span><span class="comment">      Process command line arguments.</span></div>
<div class="line"><span class="lineno">  144</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  145</span>   <span class="keywordflow">if</span> (argc &gt; 1) {</div>
<div class="line"><span class="lineno">  146</span>      <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {</div>
<div class="line"><span class="lineno">  147</span>         <span class="keywordflow">if</span> (argv[i][0] == <span class="charliteral">&#39;-&#39;</span>) {  <span class="comment">/* this is an option argument */</span></div>
<div class="line"><span class="lineno">  148</span>            <span class="keywordflow">switch</span> (argv[i][1]) {</div>
<div class="line"><span class="lineno">  149</span>               <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:  <span class="comment">/* name of input file */</span></div>
<div class="line"><span class="lineno">  150</span>                  infile = &amp;argv[i][2];</div>
<div class="line"><span class="lineno">  151</span>                  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  152</span>               <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:  <span class="comment">/* name of output file */</span></div>
<div class="line"><span class="lineno">  153</span>                  outfile = &amp;argv[i][2];</div>
<div class="line"><span class="lineno">  154</span>                  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  155</span>               <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:  <span class="comment">/* verbose output */</span></div>
<div class="line"><span class="lineno">  156</span>                  verbose = 1;</div>
<div class="line"><span class="lineno">  157</span>                  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  158</span>               <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:  <span class="comment">/* print version &amp; quit */</span></div>
<div class="line"><span class="lineno">  159</span>                  fprintf (stderr, <span class="stringliteral">&quot;unibmpbump version %s\n\n&quot;</span>, <a class="code hl_define" href="unibmpbump_8c.html#a1c6d5de492ac61ad29aec7aa9a436bbf">VERSION</a>);</div>
<div class="line"><span class="lineno">  160</span>                  exit (EXIT_SUCCESS);</div>
<div class="line"><span class="lineno">  161</span>                  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  162</span>               <span class="keywordflow">case</span> <span class="charliteral">&#39;-&#39;</span>:  <span class="comment">/* see if &quot;--verbose&quot; */</span></div>
<div class="line"><span class="lineno">  163</span>                  <span class="keywordflow">if</span> (strcmp (argv[i], <span class="stringliteral">&quot;--verbose&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  164</span>                     verbose = 1;</div>
<div class="line"><span class="lineno">  165</span>                  }</div>
<div class="line"><span class="lineno">  166</span>                  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argv[i], <span class="stringliteral">&quot;--version&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  167</span>                     fprintf (stderr, <span class="stringliteral">&quot;unibmpbump version %s\n\n&quot;</span>, <a class="code hl_define" href="unibmpbump_8c.html#a1c6d5de492ac61ad29aec7aa9a436bbf">VERSION</a>);</div>
<div class="line"><span class="lineno">  168</span>                     exit (EXIT_SUCCESS);</div>
<div class="line"><span class="lineno">  169</span>                  }</div>
<div class="line"><span class="lineno">  170</span>                  <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  171</span>               <span class="keywordflow">default</span>:   <span class="comment">/* if unrecognized option, print list and exit */</span></div>
<div class="line"><span class="lineno">  172</span>                  fprintf (stderr, <span class="stringliteral">&quot;\nSyntax:\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  173</span>                  fprintf (stderr, <span class="stringliteral">&quot;   unibmpbump &quot;</span>);</div>
<div class="line"><span class="lineno">  174</span>                  fprintf (stderr, <span class="stringliteral">&quot;-i&lt;Input_File&gt; -o&lt;Output_File&gt;\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  175</span>                  fprintf (stderr, <span class="stringliteral">&quot;-v or --verbose gives verbose output&quot;</span>);</div>
<div class="line"><span class="lineno">  176</span>                  fprintf (stderr, <span class="stringliteral">&quot; on stderr\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  177</span>                  fprintf (stderr, <span class="stringliteral">&quot;-V or --version prints version&quot;</span>);</div>
<div class="line"><span class="lineno">  178</span>                  fprintf (stderr, <span class="stringliteral">&quot; on stderr and exits\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  179</span>                  fprintf (stderr, <span class="stringliteral">&quot;\nExample:\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  180</span>                  fprintf (stderr, <span class="stringliteral">&quot;   unibmpbump -iuni0101.bmp&quot;</span>);</div>
<div class="line"><span class="lineno">  181</span>                  fprintf (stderr, <span class="stringliteral">&quot; -onew-uni0101.bmp\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  182</span>                  exit (EXIT_SUCCESS);</div>
<div class="line"><span class="lineno">  183</span>            }</div>
<div class="line"><span class="lineno">  184</span>         }</div>
<div class="line"><span class="lineno">  185</span>      }</div>
<div class="line"><span class="lineno">  186</span>   }</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  189</span><span class="comment">      Make sure we can open any I/O files that were specified before</span></div>
<div class="line"><span class="lineno">  190</span><span class="comment">      doing anything else.</span></div>
<div class="line"><span class="lineno">  191</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  192</span>   <span class="keywordflow">if</span> (strlen (infile) &gt; 0) {</div>
<div class="line"><span class="lineno">  193</span>      <span class="keywordflow">if</span> ((infp = fopen (infile, <span class="stringliteral">&quot;r&quot;</span>)) == NULL) {</div>
<div class="line"><span class="lineno">  194</span>         fprintf (stderr, <span class="stringliteral">&quot;Error: can&#39;t open %s for input.\n&quot;</span>, infile);</div>
<div class="line"><span class="lineno">  195</span>         exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  196</span>      }</div>
<div class="line"><span class="lineno">  197</span>   }</div>
<div class="line"><span class="lineno">  198</span>   <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  199</span>      infp = stdin;</div>
<div class="line"><span class="lineno">  200</span>   }</div>
<div class="line"><span class="lineno">  201</span>   <span class="keywordflow">if</span> (strlen (outfile) &gt; 0) {</div>
<div class="line"><span class="lineno">  202</span>      <span class="keywordflow">if</span> ((outfp = fopen (outfile, <span class="stringliteral">&quot;w&quot;</span>)) == NULL) {</div>
<div class="line"><span class="lineno">  203</span>         fprintf (stderr, <span class="stringliteral">&quot;Error: can&#39;t open %s for output.\n&quot;</span>, outfile);</div>
<div class="line"><span class="lineno">  204</span>         exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  205</span>      }</div>
<div class="line"><span class="lineno">  206</span>   }</div>
<div class="line"><span class="lineno">  207</span>   <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  208</span>      outfp = stdout;</div>
<div class="line"><span class="lineno">  209</span>   }</div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span> </div>
<div class="line"><span class="lineno">  212</span>   <span class="comment">/* Read bitmap file header */</span></div>
<div class="line"><span class="lineno">  213</span>   file_format[0] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  214</span>   file_format[1] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  215</span>   file_format[2] = <span class="charliteral">&#39;\0&#39;</span>;  <span class="comment">/* Terminate string with null */</span></div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>   <span class="comment">/* Read file size */</span></div>
<div class="line"><span class="lineno">  218</span>   filesize = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>   <span class="comment">/* Read Reserved bytes */</span></div>
<div class="line"><span class="lineno">  221</span>   rsvd_hdr[0] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  222</span>   rsvd_hdr[1] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  223</span>   rsvd_hdr[2] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  224</span>   rsvd_hdr[3] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  225</span> </div>
<div class="line"><span class="lineno">  226</span>   <span class="comment">/* Read Image Offset Address within file */</span></div>
<div class="line"><span class="lineno">  227</span>   image_start = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  230</span><span class="comment">      See if this looks like a valid image file based on</span></div>
<div class="line"><span class="lineno">  231</span><span class="comment">      the file header first two bytes.</span></div>
<div class="line"><span class="lineno">  232</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  233</span>   <span class="keywordflow">if</span> (strncmp (file_format, <span class="stringliteral">&quot;BM&quot;</span>, 2) != 0) {</div>
<div class="line"><span class="lineno">  234</span>      fprintf (stderr, <span class="stringliteral">&quot;\nInvalid file format: not file type \&quot;BM\&quot;.\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  235</span>      exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  236</span>   }</div>
<div class="line"><span class="lineno">  237</span> </div>
<div class="line"><span class="lineno">  238</span>   <span class="keywordflow">if</span> (verbose) {</div>
<div class="line"><span class="lineno">  239</span>      fprintf (stderr, <span class="stringliteral">&quot;\nFile Header:\n&quot;</span>);</div>
<div class="line"><span class="lineno">  240</span>      fprintf (stderr, <span class="stringliteral">&quot;   File Type:   \&quot;%s\&quot;\n&quot;</span>, file_format);</div>
<div class="line"><span class="lineno">  241</span>      fprintf (stderr, <span class="stringliteral">&quot;   File Size:   %d bytes\n&quot;</span>, filesize);</div>
<div class="line"><span class="lineno">  242</span>      fprintf (stderr, <span class="stringliteral">&quot;   Reserved:   &quot;</span>);</div>
<div class="line"><span class="lineno">  243</span>      <span class="keywordflow">for</span> (i = 0; i &lt; 4; i++) fprintf (stderr, <span class="stringliteral">&quot; 0x%02X&quot;</span>, rsvd_hdr[i]);</div>
<div class="line"><span class="lineno">  244</span>      fputc (<span class="charliteral">&#39;\n&#39;</span>, stderr);</div>
<div class="line"><span class="lineno">  245</span>      fprintf (stderr, <span class="stringliteral">&quot;   Image Start: %d. = 0x%02X = 0%05o\n\n&quot;</span>,</div>
<div class="line"><span class="lineno">  246</span>               image_start, image_start, image_start);</div>
<div class="line"><span class="lineno">  247</span>   }  <span class="comment">/* if (verbose) */</span></div>
<div class="line"><span class="lineno">  248</span> </div>
<div class="line"><span class="lineno">  249</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  250</span><span class="comment">      Device Independent Bitmap (DIB) Header: bitmap information header</span></div>
<div class="line"><span class="lineno">  251</span><span class="comment">      (&quot;BM&quot; format file DIB Header is 12 bytes long).</span></div>
<div class="line"><span class="lineno">  252</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  253</span>   dib_length = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  254</span> </div>
<div class="line"><span class="lineno">  255</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  256</span><span class="comment">      Parse one of three versions of Device Independent Bitmap (DIB) format:</span></div>
<div class="line"><span class="lineno">  257</span><span class="comment"></span> </div>
<div class="line"><span class="lineno">  258</span><span class="comment">           Length  Format</span></div>
<div class="line"><span class="lineno">  259</span><span class="comment">           ------  ------</span></div>
<div class="line"><span class="lineno">  260</span><span class="comment">              12   BITMAPCOREHEADER</span></div>
<div class="line"><span class="lineno">  261</span><span class="comment">              40   BITMAPINFOHEADER</span></div>
<div class="line"><span class="lineno">  262</span><span class="comment">             108   BITMAPV4HEADER</span></div>
<div class="line"><span class="lineno">  263</span><span class="comment">             124   BITMAPV5HEADER</span></div>
<div class="line"><span class="lineno">  264</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  265</span>   <span class="keywordflow">if</span> (dib_length == 12) { <span class="comment">/* BITMAPCOREHEADER format -- UNTESTED */</span></div>
<div class="line"><span class="lineno">  266</span>      image_width    = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 2);</div>
<div class="line"><span class="lineno">  267</span>      image_height   = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 2);</div>
<div class="line"><span class="lineno">  268</span>      num_planes     = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 2);</div>
<div class="line"><span class="lineno">  269</span>      bits_per_pixel = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 2);</div>
<div class="line"><span class="lineno">  270</span>   }</div>
<div class="line"><span class="lineno">  271</span>   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dib_length &gt;= 40) { <span class="comment">/* BITMAPINFOHEADER format or later */</span></div>
<div class="line"><span class="lineno">  272</span>      image_width = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  273</span>      image_height       = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  274</span>      num_planes         = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 2);</div>
<div class="line"><span class="lineno">  275</span>      bits_per_pixel     = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 2);</div>
<div class="line"><span class="lineno">  276</span>      compression_method = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);  <span class="comment">/* BI_BITFIELDS */</span></div>
<div class="line"><span class="lineno">  277</span>      image_size         = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  278</span>      hres               = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  279</span>      vres               = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  280</span>      num_colors         = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  281</span>      important_colors   = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  283</span>      <span class="comment">/* true_colors is true number of colors in image */</span></div>
<div class="line"><span class="lineno">  284</span>      <span class="keywordflow">if</span> (num_colors == 0)</div>
<div class="line"><span class="lineno">  285</span>         true_colors = 1 &lt;&lt; bits_per_pixel;</div>
<div class="line"><span class="lineno">  286</span>      <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  287</span>         true_colors = num_colors;</div>
<div class="line"><span class="lineno">  288</span> </div>
<div class="line"><span class="lineno">  289</span>      <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  290</span><span class="comment">         If dib_length &gt; 40, the format is BITMAPV4HEADER or</span></div>
<div class="line"><span class="lineno">  291</span><span class="comment">         BITMAPV5HEADER.  As this program is only designed</span></div>
<div class="line"><span class="lineno">  292</span><span class="comment">         to handle a monochrome image, we can ignore the rest</span></div>
<div class="line"><span class="lineno">  293</span><span class="comment">         of the header but must read past the remaining bytes.</span></div>
<div class="line"><span class="lineno">  294</span><span class="comment">      */</span></div>
<div class="line"><span class="lineno">  295</span>      <span class="keywordflow">for</span> (i = 40; i &lt; dib_length; i++) (<span class="keywordtype">void</span>)<a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  296</span>   }</div>
<div class="line"><span class="lineno">  297</span> </div>
<div class="line"><span class="lineno">  298</span>   <span class="keywordflow">if</span> (verbose) {</div>
<div class="line"><span class="lineno">  299</span>      fprintf (stderr, <span class="stringliteral">&quot;Device Independent Bitmap (DIB) Header:\n&quot;</span>);</div>
<div class="line"><span class="lineno">  300</span>      fprintf (stderr, <span class="stringliteral">&quot;   DIB Length:  %9d bytes (version = &quot;</span>, dib_length);</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>      <span class="keywordflow">if</span>      (dib_length ==  12) fprintf (stderr, <span class="stringliteral">&quot;\&quot;BITMAPCOREHEADER\&quot;)\n&quot;</span>);</div>
<div class="line"><span class="lineno">  303</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dib_length ==  40) fprintf (stderr, <span class="stringliteral">&quot;\&quot;BITMAPINFOHEADER\&quot;)\n&quot;</span>);</div>
<div class="line"><span class="lineno">  304</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dib_length == 108) fprintf (stderr, <span class="stringliteral">&quot;\&quot;BITMAPV4HEADER\&quot;)\n&quot;</span>);</div>
<div class="line"><span class="lineno">  305</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dib_length == 124) fprintf (stderr, <span class="stringliteral">&quot;\&quot;BITMAPV5HEADER\&quot;)\n&quot;</span>);</div>
<div class="line"><span class="lineno">  306</span>      <span class="keywordflow">else</span> fprintf (stderr, <span class="stringliteral">&quot;unknown)&quot;</span>);</div>
<div class="line"><span class="lineno">  307</span>      fprintf (stderr, <span class="stringliteral">&quot;   Bitmap Width:   %6d pixels\n&quot;</span>, image_width);</div>
<div class="line"><span class="lineno">  308</span>      fprintf (stderr, <span class="stringliteral">&quot;   Bitmap Height:  %6d pixels\n&quot;</span>, image_height);</div>
<div class="line"><span class="lineno">  309</span>      fprintf (stderr, <span class="stringliteral">&quot;   Color Planes:   %6d\n&quot;</span>,        num_planes);</div>
<div class="line"><span class="lineno">  310</span>      fprintf (stderr, <span class="stringliteral">&quot;   Bits per Pixel: %6d\n&quot;</span>,        bits_per_pixel);</div>
<div class="line"><span class="lineno">  311</span>      fprintf (stderr, <span class="stringliteral">&quot;   Compression Method: %2d --&gt; &quot;</span>, compression_method);</div>
<div class="line"><span class="lineno">  312</span>      <span class="keywordflow">if</span> (compression_method &lt;= <a class="code hl_define" href="unibmpbump_8c.html#aadfd205e5b62832a2ef6266260cb55f1">MAX_COMPRESSION_METHOD</a>) {</div>
<div class="line"><span class="lineno">  313</span>         fprintf (stderr, <span class="stringliteral">&quot;%s&quot;</span>, compression_type [compression_method]);</div>
<div class="line"><span class="lineno">  314</span>      }</div>
<div class="line"><span class="lineno">  315</span>      <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  316</span><span class="comment">         Supported compression method values:</span></div>
<div class="line"><span class="lineno">  317</span><span class="comment">              0 --&gt; uncompressed RGB</span></div>
<div class="line"><span class="lineno">  318</span><span class="comment">             11 --&gt; uncompressed CMYK</span></div>
<div class="line"><span class="lineno">  319</span><span class="comment">      */</span></div>
<div class="line"><span class="lineno">  320</span>      <span class="keywordflow">if</span> (compression_method == 0 || compression_method == 11) {</div>
<div class="line"><span class="lineno">  321</span>         fprintf (stderr, <span class="stringliteral">&quot; (no compression)&quot;</span>);</div>
<div class="line"><span class="lineno">  322</span>      }</div>
<div class="line"><span class="lineno">  323</span>      <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  324</span>         fprintf (stderr, <span class="stringliteral">&quot;Image uses compression; this is unsupported.\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  325</span>         exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  326</span>      }</div>
<div class="line"><span class="lineno">  327</span>      fprintf (stderr, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  328</span>      fprintf (stderr, <span class="stringliteral">&quot;   Image Size:            %5d bytes\n&quot;</span>, image_size);</div>
<div class="line"><span class="lineno">  329</span>      fprintf (stderr, <span class="stringliteral">&quot;   Horizontal Resolution: %5d pixels/meter\n&quot;</span>, hres);</div>
<div class="line"><span class="lineno">  330</span>      fprintf (stderr, <span class="stringliteral">&quot;   Vertical Resolution:   %5d pixels/meter\n&quot;</span>, vres);</div>
<div class="line"><span class="lineno">  331</span>      fprintf (stderr, <span class="stringliteral">&quot;   Number of Colors:      %5d&quot;</span>, num_colors);</div>
<div class="line"><span class="lineno">  332</span>      <span class="keywordflow">if</span> (num_colors != true_colors) {</div>
<div class="line"><span class="lineno">  333</span>         fprintf (stderr, <span class="stringliteral">&quot; --&gt; %d&quot;</span>, true_colors);</div>
<div class="line"><span class="lineno">  334</span>      }</div>
<div class="line"><span class="lineno">  335</span>      fputc (<span class="charliteral">&#39;\n&#39;</span>, stderr);</div>
<div class="line"><span class="lineno">  336</span>      fprintf (stderr, <span class="stringliteral">&quot;   Important Colors:      %5d&quot;</span>, important_colors);</div>
<div class="line"><span class="lineno">  337</span>      <span class="keywordflow">if</span> (important_colors == 0)</div>
<div class="line"><span class="lineno">  338</span>         fprintf (stderr, <span class="stringliteral">&quot; (all colors are important)&quot;</span>);</div>
<div class="line"><span class="lineno">  339</span>      fprintf (stderr, <span class="stringliteral">&quot;\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  340</span>   }  <span class="comment">/* if (verbose) */</span></div>
<div class="line"><span class="lineno">  341</span> </div>
<div class="line"><span class="lineno">  342</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  343</span><span class="comment">      Print Color Table information for images with pallettized colors.</span></div>
<div class="line"><span class="lineno">  344</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  345</span>   <span class="keywordflow">if</span> (bits_per_pixel &lt;= 8) {</div>
<div class="line"><span class="lineno">  346</span>      <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {</div>
<div class="line"><span class="lineno">  347</span>         color_map [i][0] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  348</span>         color_map [i][1] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  349</span>         color_map [i][2] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  350</span>         color_map [i][3] = <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1);</div>
<div class="line"><span class="lineno">  351</span>      }</div>
<div class="line"><span class="lineno">  352</span>      <span class="comment">/* Skip remaining color table entries if more than 2 */</span></div>
<div class="line"><span class="lineno">  353</span>      <span class="keywordflow">while</span> (i &lt; true_colors) {</div>
<div class="line"><span class="lineno">  354</span>         (void) <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 4);</div>
<div class="line"><span class="lineno">  355</span>         i++;</div>
<div class="line"><span class="lineno">  356</span>      }</div>
<div class="line"><span class="lineno">  357</span> </div>
<div class="line"><span class="lineno">  358</span>      <span class="keywordflow">if</span> (color_map [0][0] &gt;= 128) image_xor = 0xFF;  <span class="comment">/* Invert colors */</span></div>
<div class="line"><span class="lineno">  359</span>   }</div>
<div class="line"><span class="lineno">  360</span> </div>
<div class="line"><span class="lineno">  361</span>   <span class="keywordflow">if</span> (verbose) {</div>
<div class="line"><span class="lineno">  362</span>      fprintf (stderr, <span class="stringliteral">&quot;Color Palette [R, G, B, %s] Values:\n&quot;</span>,</div>
<div class="line"><span class="lineno">  363</span>               (dib_length &lt;= 40) ? <span class="stringliteral">&quot;reserved&quot;</span> : <span class="stringliteral">&quot;Alpha&quot;</span>);</div>
<div class="line"><span class="lineno">  364</span>      <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {</div>
<div class="line"><span class="lineno">  365</span>         fprintf (stderr, <span class="stringliteral">&quot;%7d: [&quot;</span>, i);</div>
<div class="line"><span class="lineno">  366</span>         fprintf (stderr, <span class="stringliteral">&quot;%3d,&quot;</span>,   color_map [i][0] &amp; 0xFF);</div>
<div class="line"><span class="lineno">  367</span>         fprintf (stderr, <span class="stringliteral">&quot;%3d,&quot;</span>,   color_map [i][1] &amp; 0xFF);</div>
<div class="line"><span class="lineno">  368</span>         fprintf (stderr, <span class="stringliteral">&quot;%3d,&quot;</span>,   color_map [i][2] &amp; 0xFF);</div>
<div class="line"><span class="lineno">  369</span>         fprintf (stderr, <span class="stringliteral">&quot;%3d]\n&quot;</span>, color_map [i][3] &amp; 0xFF);</div>
<div class="line"><span class="lineno">  370</span>      }</div>
<div class="line"><span class="lineno">  371</span>      <span class="keywordflow">if</span> (image_xor == 0xFF) fprintf (stderr, <span class="stringliteral">&quot;Will Invert Colors.\n&quot;</span>);</div>
<div class="line"><span class="lineno">  372</span>      fputc (<span class="charliteral">&#39;\n&#39;</span>, stderr);</div>
<div class="line"><span class="lineno">  373</span> </div>
<div class="line"><span class="lineno">  374</span>   }  <span class="comment">/* if (verbose) */</span></div>
<div class="line"><span class="lineno">  375</span> </div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  378</span><span class="comment">      Check format before writing output file.</span></div>
<div class="line"><span class="lineno">  379</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  380</span>   <span class="keywordflow">if</span> (image_width != 560 &amp;&amp; image_width != 576) {</div>
<div class="line"><span class="lineno">  381</span>      fprintf (stderr, <span class="stringliteral">&quot;\nUnsupported image width: %d\n&quot;</span>, image_width);</div>
<div class="line"><span class="lineno">  382</span>      fprintf (stderr, <span class="stringliteral">&quot;Width should be 560 or 576 pixels.\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  383</span>      exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  384</span>   }</div>
<div class="line"><span class="lineno">  385</span> </div>
<div class="line"><span class="lineno">  386</span>   <span class="keywordflow">if</span> (image_height != 544) {</div>
<div class="line"><span class="lineno">  387</span>      fprintf (stderr, <span class="stringliteral">&quot;\nUnsupported image height: %d\n&quot;</span>, image_height);</div>
<div class="line"><span class="lineno">  388</span>      fprintf (stderr, <span class="stringliteral">&quot;Height should be 544 pixels.\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  389</span>      exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  390</span>   }</div>
<div class="line"><span class="lineno">  391</span> </div>
<div class="line"><span class="lineno">  392</span>   <span class="keywordflow">if</span> (num_planes != 1) {</div>
<div class="line"><span class="lineno">  393</span>      fprintf (stderr, <span class="stringliteral">&quot;\nUnsupported number of planes: %d\n&quot;</span>, num_planes);</div>
<div class="line"><span class="lineno">  394</span>      fprintf (stderr, <span class="stringliteral">&quot;Number of planes should be 1.\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  395</span>      exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  396</span>   }</div>
<div class="line"><span class="lineno">  397</span> </div>
<div class="line"><span class="lineno">  398</span>   <span class="keywordflow">if</span> (bits_per_pixel != 1) {</div>
<div class="line"><span class="lineno">  399</span>      fprintf (stderr, <span class="stringliteral">&quot;\nUnsupported number of bits per pixel: %d\n&quot;</span>,</div>
<div class="line"><span class="lineno">  400</span>               bits_per_pixel);</div>
<div class="line"><span class="lineno">  401</span>      fprintf (stderr, <span class="stringliteral">&quot;Bits per pixel should be 1.\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  402</span>      exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  403</span>   }</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>   <span class="keywordflow">if</span> (compression_method != 0 &amp;&amp; compression_method != 11) {</div>
<div class="line"><span class="lineno">  406</span>      fprintf (stderr, <span class="stringliteral">&quot;\nUnsupported compression method: %d\n&quot;</span>,</div>
<div class="line"><span class="lineno">  407</span>               compression_method);</div>
<div class="line"><span class="lineno">  408</span>      fprintf (stderr, <span class="stringliteral">&quot;Compression method should be 1 or 11.\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  409</span>      exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  410</span>   }</div>
<div class="line"><span class="lineno">  411</span> </div>
<div class="line"><span class="lineno">  412</span>   <span class="keywordflow">if</span> (true_colors != 2) {</div>
<div class="line"><span class="lineno">  413</span>      fprintf (stderr, <span class="stringliteral">&quot;\nUnsupported number of colors: %d\n&quot;</span>, true_colors);</div>
<div class="line"><span class="lineno">  414</span>      fprintf (stderr, <span class="stringliteral">&quot;Number of colors should be 2.\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  415</span>      exit (EXIT_FAILURE);</div>
<div class="line"><span class="lineno">  416</span>   }</div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span> </div>
<div class="line"><span class="lineno">  419</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  420</span><span class="comment">      If we made it this far, things look okay, so write out</span></div>
<div class="line"><span class="lineno">  421</span><span class="comment">      the standard header for image conversion.</span></div>
<div class="line"><span class="lineno">  422</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  423</span>   <span class="keywordflow">for</span> (i = 0; i &lt; 62; i++) fputc (standard_header[i], outfp);</div>
<div class="line"><span class="lineno">  424</span> </div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  427</span><span class="comment">      Image Data.  Each row must be a multiple of 4 bytes, with</span></div>
<div class="line"><span class="lineno">  428</span><span class="comment">      padding at the end of each row if necessary.</span></div>
<div class="line"><span class="lineno">  429</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  430</span>   k = 0;  <span class="comment">/* byte number within the binary image */</span></div>
<div class="line"><span class="lineno">  431</span>   <span class="keywordflow">for</span> (i = 0; i &lt; 544; i++) {</div>
<div class="line"><span class="lineno">  432</span>      <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  433</span><span class="comment">         If original image is 560 pixels wide (not 576), add</span></div>
<div class="line"><span class="lineno">  434</span><span class="comment">         2 white bytes at beginning of row.</span></div>
<div class="line"><span class="lineno">  435</span><span class="comment">      */</span></div>
<div class="line"><span class="lineno">  436</span>      <span class="keywordflow">if</span> (image_width == 560) {  <span class="comment">/* Insert 2 white bytes */</span></div>
<div class="line"><span class="lineno">  437</span>         image_bytes[k++] = 0xFF;</div>
<div class="line"><span class="lineno">  438</span>         image_bytes[k++] = 0xFF;</div>
<div class="line"><span class="lineno">  439</span>      }</div>
<div class="line"><span class="lineno">  440</span>      <span class="keywordflow">for</span> (j = 0; j &lt; 70; j++) {  <span class="comment">/* Copy next 70 bytes */</span></div>
<div class="line"><span class="lineno">  441</span>         image_bytes[k++] = (<a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1) &amp; 0xFF) ^ image_xor;</div>
<div class="line"><span class="lineno">  442</span>      }</div>
<div class="line"><span class="lineno">  443</span>      <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  444</span><span class="comment">         If original image is 560 pixels wide (not 576), skip</span></div>
<div class="line"><span class="lineno">  445</span><span class="comment">         2 padding bytes at end of row in file because we inserted</span></div>
<div class="line"><span class="lineno">  446</span><span class="comment">         2 white bytes at the beginning of the row.</span></div>
<div class="line"><span class="lineno">  447</span><span class="comment">      */</span></div>
<div class="line"><span class="lineno">  448</span>      <span class="keywordflow">if</span> (image_width == 560) {</div>
<div class="line"><span class="lineno">  449</span>         (void) <a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 2);</div>
<div class="line"><span class="lineno">  450</span>      }</div>
<div class="line"><span class="lineno">  451</span>      <span class="keywordflow">else</span> {  <span class="comment">/* otherwise, next 2 bytes are part of the image so copy them */</span></div>
<div class="line"><span class="lineno">  452</span>         image_bytes[k++] = (<a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1) &amp; 0xFF) ^ image_xor;</div>
<div class="line"><span class="lineno">  453</span>         image_bytes[k++] = (<a class="code hl_function" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a> (infp, 1) &amp; 0xFF) ^ image_xor;</div>
<div class="line"><span class="lineno">  454</span>      }</div>
<div class="line"><span class="lineno">  455</span>   }</div>
<div class="line"><span class="lineno">  456</span> </div>
<div class="line"><span class="lineno">  457</span> </div>
<div class="line"><span class="lineno">  458</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  459</span><span class="comment">      Change the image to match the unihex2bmp.c format if original wasn&#39;t</span></div>
<div class="line"><span class="lineno">  460</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  461</span>   <span class="keywordflow">if</span> (image_width == 560) {</div>
<div class="line"><span class="lineno">  462</span>      <a class="code hl_function" href="unibmpbump_8c.html#a58f734bf43b58f0f2c28fd4a0582c0f4">regrid</a> (image_bytes);</div>
<div class="line"><span class="lineno">  463</span>   }</div>
<div class="line"><span class="lineno">  464</span> </div>
<div class="line"><span class="lineno">  465</span>   <span class="keywordflow">for</span> (i = 0; i &lt; 544 * 576 / 8; i++) {</div>
<div class="line"><span class="lineno">  466</span>      fputc (image_bytes[i], outfp);</div>
<div class="line"><span class="lineno">  467</span>   }</div>
<div class="line"><span class="lineno">  468</span> </div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  471</span><span class="comment">      Wrap up.</span></div>
<div class="line"><span class="lineno">  472</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  473</span>   fclose (infp);</div>
<div class="line"><span class="lineno">  474</span>   fclose (outfp);</div>
<div class="line"><span class="lineno">  475</span> </div>
<div class="line"><span class="lineno">  476</span>   exit (EXIT_SUCCESS);</div>
<div class="line"><span class="lineno">  477</span>}</div>
<div class="ttc" id="aunibmpbump_8c_html_a1c6d5de492ac61ad29aec7aa9a436bbf"><div class="ttname"><a href="unibmpbump_8c.html#a1c6d5de492ac61ad29aec7aa9a436bbf">VERSION</a></div><div class="ttdeci">#define VERSION</div><div class="ttdoc">Version of this program.</div><div class="ttdef"><b>Definition:</b> <a href="unibmpbump_8c_source.html#l00038">unibmpbump.c:38</a></div></div>
<div class="ttc" id="aunibmpbump_8c_html_a58f734bf43b58f0f2c28fd4a0582c0f4"><div class="ttname"><a href="unibmpbump_8c.html#a58f734bf43b58f0f2c28fd4a0582c0f4">regrid</a></div><div class="ttdeci">void regrid(unsigned *image_bytes)</div><div class="ttdoc">After reading in the image, shift it.</div><div class="ttdef"><b>Definition:</b> <a href="unibmpbump_8c_source.html#l00514">unibmpbump.c:514</a></div></div>
<div class="ttc" id="aunibmpbump_8c_html_aadfd205e5b62832a2ef6266260cb55f1"><div class="ttname"><a href="unibmpbump_8c.html#aadfd205e5b62832a2ef6266260cb55f1">MAX_COMPRESSION_METHOD</a></div><div class="ttdeci">#define MAX_COMPRESSION_METHOD</div><div class="ttdoc">Maximum supported compression method.</div><div class="ttdef"><b>Definition:</b> <a href="unibmpbump_8c_source.html#l00040">unibmpbump.c:40</a></div></div>
<div class="ttc" id="aunibmpbump_8c_html_ace9584f7b69b95621366833332b30465"><div class="ttname"><a href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465">get_bytes</a></div><div class="ttdeci">unsigned get_bytes(FILE *infp, int nbytes)</div><div class="ttdoc">Get from 1 to 4 bytes, inclusive, from input file.</div><div class="ttdef"><b>Definition:</b> <a href="unibmpbump_8c_source.html#l00487">unibmpbump.c:487</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="unibmpbump_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph.png" border="0" usemap="#aunibmpbump_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph" alt=""/></div>
<map name="aunibmpbump_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph" id="aunibmpbump_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph">
<area shape="rect" title="The main function." alt="" coords="5,31,60,56"/>
<area shape="rect" href="unibmpbump_8c.html#ace9584f7b69b95621366833332b30465" title="Get from 1 to 4 bytes, inclusive, from input file." alt="" coords="108,5,195,31"/>
<area shape="rect" href="unibmpbump_8c.html#a58f734bf43b58f0f2c28fd4a0582c0f4" title="After reading in the image, shift it." alt="" coords="121,55,181,80"/>
</map>
</div>

</div>
</div>
<a id="a58f734bf43b58f0f2c28fd4a0582c0f4" name="a58f734bf43b58f0f2c28fd4a0582c0f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58f734bf43b58f0f2c28fd4a0582c0f4">&#9670;&#160;</a></span>regrid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void regrid </td>
          <td>(</td>
          <td class="paramtype">unsigned *&#160;</td>
          <td class="paramname"><em>image_bytes</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>After reading in the image, shift it. </p>
<p>This function adjusts the input image from an original PNG file to match <a class="el" href="unihex2bmp_8c.html" title="unihex2bmp - Turn a GNU Unifont hex glyph page of 256 code points into a bitmap for editing">unihex2bmp.c</a> format.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">image_bytes</td><td>The pixels in an image. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="unibmpbump_8c_source.html#l00514">514</a> of file <a class="el" href="unibmpbump_8c_source.html">unibmpbump.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  514</span>                                    {</div>
<div class="line"><span class="lineno">  515</span>   <span class="keywordtype">int</span> i, j, k;  <span class="comment">/* loop variables */</span></div>
<div class="line"><span class="lineno">  516</span>   <span class="keywordtype">int</span> offset;</div>
<div class="line"><span class="lineno">  517</span>   <span class="keywordtype">unsigned</span> glyph_row; <span class="comment">/* one grid row of 32 pixels */</span></div>
<div class="line"><span class="lineno">  518</span>   <span class="keywordtype">unsigned</span> last_pixel; <span class="comment">/* last pixel in a byte, to preserve */</span></div>
<div class="line"><span class="lineno">  519</span> </div>
<div class="line"><span class="lineno">  520</span>   <span class="comment">/* To insert &quot;00&quot; after &quot;U+&quot; at top of image */</span></div>
<div class="line"><span class="lineno">  521</span>   <span class="keywordtype">char</span> zero_pattern[16] = {</div>
<div class="line"><span class="lineno">  522</span>       0x00, 0x00, 0x00, 0x00, 0x18, 0x24, 0x42, 0x42,</div>
<div class="line"><span class="lineno">  523</span>       0x42, 0x42, 0x42, 0x42, 0x24, 0x18, 0x00, 0x00</div>
<div class="line"><span class="lineno">  524</span>   };</div>
<div class="line"><span class="lineno">  525</span> </div>
<div class="line"><span class="lineno">  526</span>   <span class="comment">/* This is the horizontal grid pattern on glyph boundaries */</span></div>
<div class="line"><span class="lineno">  527</span>   <span class="keywordtype">unsigned</span> hgrid[72] = {</div>
<div class="line"><span class="lineno">  528</span>      <span class="comment">/*  0 */</span> 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe,</div>
<div class="line"><span class="lineno">  529</span>      <span class="comment">/*  8 */</span> 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,</div>
<div class="line"><span class="lineno">  530</span>      <span class="comment">/* 16 */</span> 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,</div>
<div class="line"><span class="lineno">  531</span>      <span class="comment">/* 24 */</span> 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,</div>
<div class="line"><span class="lineno">  532</span>      <span class="comment">/* 32 */</span> 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,</div>
<div class="line"><span class="lineno">  533</span>      <span class="comment">/* 40 */</span> 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,</div>
<div class="line"><span class="lineno">  534</span>      <span class="comment">/* 48 */</span> 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,</div>
<div class="line"><span class="lineno">  535</span>      <span class="comment">/* 56 */</span> 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00,</div>
<div class="line"><span class="lineno">  536</span>      <span class="comment">/* 64 */</span> 0x00, 0x81, 0x81, 0x00, 0x00, 0x81, 0x81, 0x00</div>
<div class="line"><span class="lineno">  537</span>   };</div>
<div class="line"><span class="lineno">  538</span> </div>
<div class="line"><span class="lineno">  539</span> </div>
<div class="line"><span class="lineno">  540</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  541</span><span class="comment">      First move &quot;U+&quot; left and insert &quot;00&quot; after it.</span></div>
<div class="line"><span class="lineno">  542</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  543</span>   j = 15; <span class="comment">/* rows are written bottom to top, so we&#39;ll decrement j */</span></div>
<div class="line"><span class="lineno">  544</span>   <span class="keywordflow">for</span> (i = 543 - 8; i &gt; 544 - 24; i--) {</div>
<div class="line"><span class="lineno">  545</span>      offset = 72 * i;</div>
<div class="line"><span class="lineno">  546</span>      image_bytes [offset + 0] = image_bytes [offset + 2];</div>
<div class="line"><span class="lineno">  547</span>      image_bytes [offset + 1] = image_bytes [offset + 3];</div>
<div class="line"><span class="lineno">  548</span>      image_bytes [offset + 2] = image_bytes [offset + 4];</div>
<div class="line"><span class="lineno">  549</span>      image_bytes [offset + 3] = image_bytes [offset + 4] =</div>
<div class="line"><span class="lineno">  550</span>         ~zero_pattern[15 - j--] &amp; 0xFF;</div>
<div class="line"><span class="lineno">  551</span>   }</div>
<div class="line"><span class="lineno">  552</span> </div>
<div class="line"><span class="lineno">  553</span>   <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  554</span><span class="comment">      Now move glyph bitmaps to the right by 8 pixels.</span></div>
<div class="line"><span class="lineno">  555</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno">  556</span>   <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) { <span class="comment">/* for each glyph row */</span></div>
<div class="line"><span class="lineno">  557</span>      <span class="keywordflow">for</span> (j = 0; j &lt; 16; j++) { <span class="comment">/* for each glyph column */</span></div>
<div class="line"><span class="lineno">  558</span>         <span class="comment">/* set offset to lower left-hand byte of next glyph */</span></div>
<div class="line"><span class="lineno">  559</span>         offset = (32 * 72 * i) + (9 * 72) + (4 * j) + 8;</div>
<div class="line"><span class="lineno">  560</span>         <span class="keywordflow">for</span> (k = 0; k &lt; 16; k++) { <span class="comment">/* for each glyph row */</span></div>
<div class="line"><span class="lineno">  561</span>            glyph_row = (image_bytes [offset + 0] &lt;&lt; 24) |</div>
<div class="line"><span class="lineno">  562</span>                        (image_bytes [offset + 1] &lt;&lt; 16) |</div>
<div class="line"><span class="lineno">  563</span>                        (image_bytes [offset + 2] &lt;&lt;  8) |</div>
<div class="line"><span class="lineno">  564</span>                        (image_bytes [offset + 3]);</div>
<div class="line"><span class="lineno">  565</span>            last_pixel = glyph_row &amp; 1;  <span class="comment">/* preserve border */</span></div>
<div class="line"><span class="lineno">  566</span>            glyph_row &gt;&gt;= 4;</div>
<div class="line"><span class="lineno">  567</span>            glyph_row &amp;=  0x0FFFFFFE;</div>
<div class="line"><span class="lineno">  568</span>            <span class="comment">/* Set left 4 pixels to white and preserve last pixel */</span></div>
<div class="line"><span class="lineno">  569</span>            glyph_row |=  0xF0000000 | last_pixel;</div>
<div class="line"><span class="lineno">  570</span>            image_bytes [offset + 3] = glyph_row &amp; 0xFF;</div>
<div class="line"><span class="lineno">  571</span>            glyph_row &gt;&gt;= 8;</div>
<div class="line"><span class="lineno">  572</span>            image_bytes [offset + 2] = glyph_row &amp; 0xFF;</div>
<div class="line"><span class="lineno">  573</span>            glyph_row &gt;&gt;= 8;</div>
<div class="line"><span class="lineno">  574</span>            image_bytes [offset + 1] = glyph_row &amp; 0xFF;</div>
<div class="line"><span class="lineno">  575</span>            glyph_row &gt;&gt;= 8;</div>
<div class="line"><span class="lineno">  576</span>            image_bytes [offset + 0] = glyph_row &amp; 0xFF;</div>
<div class="line"><span class="lineno">  577</span>            offset += 72;  <span class="comment">/* move up to next row in current glyph */</span></div>
<div class="line"><span class="lineno">  578</span>         }</div>
<div class="line"><span class="lineno">  579</span>      }</div>
<div class="line"><span class="lineno">  580</span>   }</div>
<div class="line"><span class="lineno">  581</span> </div>
<div class="line"><span class="lineno">  582</span>   <span class="comment">/* Replace horizontal grid with unihex2bmp.c grid */</span></div>
<div class="line"><span class="lineno">  583</span>   <span class="keywordflow">for</span> (i = 0; i &lt;= 16; i++) {</div>
<div class="line"><span class="lineno">  584</span>      offset = 32 * 72 * i;</div>
<div class="line"><span class="lineno">  585</span>      <span class="keywordflow">for</span> (j = 0; j &lt; 72; j++) {</div>
<div class="line"><span class="lineno">  586</span>         image_bytes [offset + j] = hgrid [j];</div>
<div class="line"><span class="lineno">  587</span>      }</div>
<div class="line"><span class="lineno">  588</span>   }</div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>   <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  591</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="unibmpbump_8c_a58f734bf43b58f0f2c28fd4a0582c0f4_icgraph.png" border="0" usemap="#aunibmpbump_8c_a58f734bf43b58f0f2c28fd4a0582c0f4_icgraph" alt=""/></div>
<map name="aunibmpbump_8c_a58f734bf43b58f0f2c28fd4a0582c0f4_icgraph" id="aunibmpbump_8c_a58f734bf43b58f0f2c28fd4a0582c0f4_icgraph">
<area shape="rect" title="After reading in the image, shift it." alt="" coords="108,5,168,31"/>
<area shape="rect" href="unibmpbump_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="The main function." alt="" coords="5,5,60,31"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="unibmpbump_8c.html">unibmpbump.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
